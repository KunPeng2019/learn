webpackJsonp([41],{"1JVM":function(t,e){},Klxv:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Dd8w"),n=a.n(s),o=a("mvHQ"),i=a.n(o),r=a("7GJr"),c=a("6jqi"),l=a("oAV5"),u={name:"",components:{commonTable:r.a},mixins:[c.a],props:{},data:function(){return{weekCount:0,weekName:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],weekData:[],weekIndex:0,dateRange:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},formData:{startDate:"",endDate:"",psize:20,pno:1},tableColumns:[{prop:"CourseName",label:"课程名称",width:139},{prop:"ClassName",label:"班级",width:139},{prop:"ClassroomName",label:"教室"},{prop:"TeacherName",label:"上课老师"},{prop:"ClassDate",label:"上课日期",slot:!0,width:92},{prop:"StartTime",label:"上课时间",slot:!0,width:104},{prop:"State",label:"状态",slot:!0,width:80},{prop:"oprate",label:"操作",slot:!0,width:290}],tableDatas:[],dataTotal:0,keyIdName:"CourseID",selectedIds:[],deleteLoading:!1,inputSearch:"",dialogVisible:!1,formComment:{id:"",courseID:"",comment:"",anonymous:!1,score:100},rulesComment:{comment:{required:!0,min:1,max:500,message:"长度在 1 到 500 个字符",trigger:"blur"},score:[{required:!0,message:"课程评分不能为空"},{type:"number",message:"课程评分必须为数字值"}]},btnLoading:!1,courseState:{before:0,at:1,after:2},questionList:[],questionTabOptions:[],questionTabSelected:"",questionTableVisible:!1,formQuestion:{id:"",courseID:"",content:""}}},computed:{},watch:{},created:function(){this.total=this.tableDatas.length,this.init()},mounted:function(){},methods:{init:function(){this.weekIndex=(new Date).getDay()-1,this.weekIndex=-1===this.weekIndex?6:this.weekIndex,this.dateRange=[],this.weekDataChange(0)},weekDataChange:function(t){this.weekCount+=t,this.weekData=[];for(var e=0;e<7;e++)this.weekData.push({date:Object(l.d)(e,this.weekCount),total:0});this.getCourseStatistics(),this.selectDate(this.weekData[this.weekIndex],this.weekIndex)},formatDate:function(t,e){return Object(l.b)(t,e)},searchData:function(){var t=this;this.tableDatas=[],this.$http.get(this.$api.StuCourseDatas,{startDate:this.formData.startDate,endDate:this.formData.endDate,stuid:this.$http.getStu().StudentID,pno:this.formData.pno,psize:this.formData.psize,estate:-1,key:this.inputSearch}).then(function(e){e.Result&&e.Datas&&e.Datas.length>0&&e.Datas.forEach(function(e){t.tableDatas.push(e)}),e.Result&&(t.dataTotal=e.RowsCount||0)}).catch(function(t){})},pageChange:function(t){this.formData.pno=t,this.searchData()},selectDate:function(t,e){this.weekIndex=e,this.formData.startDate=t.date,this.formData.endDate=t.date,this.searchData()},selectDateRange:function(){2===this.dateRange.length&&(this.formData.startDate=this.dateRange[0],this.formData.endDate=this.dateRange[1],this.weekIndex=-1)},getCourseStatistics:function(){var t=this;this.$http.get(this.$api.StuCourseDatas,{startDate:this.weekData[0].date,endDate:this.weekData[6].date,stuid:this.$http.getStu().StudentID,estate:-1,key:this.inputSearch}).then(function(e){e.Result&&e.Datas&&e.Datas.length>0&&e.Datas.forEach(function(e){var a=Object(l.b)(e.ClassDate,"yyyy-MM-dd"),s=t.weekData.findIndex(function(t){return t.date===a});t.weekData[s].total+=1})}).catch(function(t){})},selectChange:function(t){this.selectedIds=t},courseRecord:function(t){sessionStorage.setItem("course",i()(t)),sessionStorage.setItem("courseID",t.CourseID),this.$router.push("/main/studentSpace/classRecord")},courseEvaluate:function(t){this.formComment={id:"",courseID:t.CourseID,comment:"",anonymous:!1,score:100},this.getCourseEvaluate(),this.dialogVisible=!0},getCourseEvaluate:function(){var t=this,e={courseID:this.formComment.courseID,studentID:this.$http.getStu().StudentID};this.$http.get(this.$api.CourseCommentData,e).then(function(e){e.Result&&e.Data&&(t.formComment.id=e.Data.CCID,t.formComment.comment=e.Data.Comment,t.formComment.score=e.Data.Score,t.formComment.anonymous=!!e.Data.IsAnonymous)})},saveForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return e.$message({showClose:!0,message:"请输入正确格式",type:"error"}),!1;e.btnLoading=!0;var a={ccID:e.formComment.id,courseID:e.formComment.courseID,studentID:e.$http.getStu().StudentID,score:e.formComment.score,comment:e.formComment.comment,isAnonymous:e.formComment.anonymous?1:0,type:2};e.$http.post(e.$api.CourseCommentSave,a).then(function(t){t.Result?(e.dialogVisible=!1,e.$message({message:"提交成功！",type:"success"})):t.message&&e.$message(n()({showClose:!0},t)),e.btnLoading=!1}).catch(function(t){e.btnLoading=!1})})},courseQuestion:function(t){this.formQuestion.courseID=t.CourseID;var e=t.State;e===this.courseState.before?this.questionTabOptions=[{name:"1",label:"预习",disabled:!1}]:e===this.courseState.at?this.questionTabOptions=[{name:"1",label:"预习",disabled:!0},{name:"2",label:"课中",disabled:!0}]:e===this.courseState.after&&(this.questionTabOptions=[{name:"1",label:"预习",disabled:!0},{name:"2",label:"课中",disabled:!0},{name:"3",label:"复习",disabled:!1}]),this.questionTabSelected=this.questionTabOptions[e].name,this.courseQuestionGet(),this.questionTableVisible=!0},courseQuestionGet:function(){var t=this;this.formQuestion.content="",this.questionList=[],this.$http.get(this.$api.GetQuestionDatas,{courseID:this.formQuestion.courseID,studentID:this.$http.getStu().StudentID,attribute:this.questionTabSelected}).then(function(e){if(e.Result&&e.Datas&&e.Datas.length>0){e.Datas.forEach(function(e,a){t.questionList.push(e)});var a=t.questionTabSelected;setTimeout(function(){t.$refs["chat"+a][0].scrollTop=t.$refs["chat"+a][0].scrollHeight},100)}})},courseQuestionSave:function(){var t=this;if(!this.formQuestion.content)return this.$message({showClose:!0,message:"请输入提问内容",type:"error"}),!1;var e={qID:this.formQuestion.id,courseID:this.formQuestion.courseID,studentID:this.$http.getStu().StudentID,attribute:this.questionTabSelected,qContent:this.formQuestion.content};this.btnLoading=!0,this.$http.post(this.$api.questionDataSave,e).then(function(e){e.Result?(t.$message({message:"提交成功！",type:"success"}),t.courseQuestionGet()):e.message&&t.$message(n()({showClose:!0},e)),t.btnLoading=!1}).catch(function(e){t.btnLoading=!1})},courseQuestionConfirm:function(t){var e=this;this.$confirm("确认删除此提问?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.courseQuestionDelete(t)}).catch(function(){})},courseQuestionDelete:function(t){var e=this;this.$http.post(this.$api.questionDataDelete,{ids:t}).then(function(t){t.Result?(e.$message({message:"删除成功！",type:"success"}),e.courseQuestionGet()):t.message&&e.$message(n()({showClose:!0},t))}).catch(function(t){})},timeFormat:function(t){return t.length<8?t:t.substring(0,t.length-3)}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"course-view"}},[a("div",{staticClass:"main"},[a("div",{staticClass:"top"},[a("div",{staticClass:"tt"},[t._v("我的课程")]),t._v(" "),a("div",{staticClass:"top_operate"},[a("el-date-picker",{staticStyle:{width:"300px"},attrs:{size:"small",type:"daterange",align:"right","unlink-panels":"",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.pickerOptions},on:{change:t.selectDateRange},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}}),t._v(" "),a("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"请输入内容",size:"small"},model:{value:t.inputSearch,callback:function(e){t.inputSearch=e},expression:"inputSearch"}},[a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:t.searchData},slot:"append"},[t._v("搜索")])],1)],1)]),t._v(" "),a("div",{staticClass:"filter-date"},[a("div",{staticClass:"date"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.weekDataChange(-1)}}},[t._v("上一周")]),t._v(" "),t._l(t.weekData,function(e,s){return a("div",{key:s,staticClass:"item",class:t.weekIndex===s?"active":"",on:{click:function(a){t.selectDate(e,s)}}},[a("div",{staticClass:"info"},[a("div",{staticClass:"day"},[t._v(t._s(t.weekName[s]))]),t._v(" "),a("div",{staticClass:"dt"},[t._v(t._s(e.date))]),t._v(" "),a("div",{staticClass:"nus"},[t._v(t._s(e.total))])])])}),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.weekDataChange(1)}}},[t._v("下一周")])],2)]),t._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"table"},[a("common-table",{attrs:{columns:t.tableColumns,datas:t.tableDatas,"th-class":"table-innerhead",border:"",select:!0,pagger:!1,"data-id":t.keyIdName},on:{selectHandler:t.selectChange},scopedSlots:t._u([{key:"ClassDate",fn:function(e){return[a("span",[t._v(t._s(t._f("formatDate")(e.row.ClassDate,e.row.ClassDate)))])]}},{key:"StartTime",fn:function(e){return[a("span",[t._v(t._s(t.timeFormat(e.row.StartTime))+" - "+t._s(t.timeFormat(e.row.EndTime)))])]}},{key:"State",fn:function(e){return[0==e.row.State?a("span",[t._v("未上课")]):t._e(),t._v(" "),1==e.row.State?a("span",[t._v("上课中")]):t._e(),t._v(" "),2==e.row.State?a("span",[t._v("已结束")]):t._e()]}},{key:"oprate",fn:function(e){return[a("el-button",{staticStyle:{background:"#6acfce","border-color":"#6acfce"},attrs:{type:"primary",size:"mini"},on:{click:function(a){t.courseRecord(e.row)}}},[t._v("课堂记录\n            ")]),t._v(" "),e.row.State===t.courseState.after?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.courseEvaluate(e.row)}}},[t._v("课程评价\n            ")]):t._e(),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.courseQuestion(e.row)}}},[t._v("课程提问\n            ")])]}}])}),t._v(" "),a("div",{staticClass:"personal-bottom-pager"},[a("el-pagination",{staticClass:"personnal-detail-wrap-pager",attrs:{layout:"prev, pager, next","current-page":t.formData.pno,"page-size":t.formData.psize,total:t.dataTotal,"prev-text":"上一页","next-text":"下一页"},on:{"update:currentPage":function(e){t.$set(t.formData,"pno",e)},"current-change":t.pageChange}})],1)],1)]),t._v(" "),a("el-dialog",{staticStyle:{"text-align":"left"},attrs:{title:"课程评价",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"formComment",attrs:{model:t.formComment,rules:t.rulesComment,size:"small","label-width":"80px"}},[a("el-form-item",{attrs:{label:"课程评分",prop:"score"}},[a("el-input-number",{attrs:{min:1,max:100,label:"课程评分","controls-position":"right",precision:0,step:1},model:{value:t.formComment.score,callback:function(e){t.$set(t.formComment,"score",e)},expression:"formComment.score"}}),t._v("\n          分\n        ")],1),t._v(" "),a("el-form-item",{attrs:{label:"课程评价",prop:"comment"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:10},placeholder:"请输入课程评价",maxlength:"500","show-word-limit":!0},model:{value:t.formComment.comment,callback:function(e){t.$set(t.formComment,"comment",e)},expression:"formComment.comment"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"",prop:"comment"}},[a("el-checkbox",{model:{value:t.formComment.anonymous,callback:function(e){t.$set(t.formComment,"anonymous",e)},expression:"formComment.anonymous"}},[t._v("匿名评价")])],1),t._v(" "),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{loading:t.btnLoading,type:"primary"},on:{click:function(e){t.saveForm("formComment")}}},[t._v("\n            "+t._s(t.formComment.id?"更新评价":"保存")+"\n          ")])],1)],1)],1),t._v(" "),a("el-dialog",{staticClass:"dialog_chat",attrs:{title:"课程提问",visible:t.questionTableVisible},on:{"update:visible":function(e){t.questionTableVisible=e}}},[a("el-tabs",{on:{"tab-click":t.courseQuestionGet},model:{value:t.questionTabSelected,callback:function(e){t.questionTabSelected=e},expression:"questionTabSelected"}},t._l(t.questionTabOptions,function(e,s){return a("el-tab-pane",{key:s,attrs:{label:e.label,name:e.name}},[a("div",{ref:"chat"+e.name,refInFor:!0,staticClass:"chat"},[t.questionList&&t.questionList.length>0?a("div",{staticClass:"chat_content"},t._l(t.questionList,function(e,s){return a("div",{key:s,staticClass:" chat_item"},[a("div",{staticClass:"chat_news"},[a("div",{staticClass:"chat_news_name"},[t._v("\n                    "+t._s(e.StudentName)+"\n                    "),a("span",[t._v(t._s(t.formatDate(e.CreateTime,"hh:mm:ss")))]),t._v(" "),a("i",{staticClass:"el-icon-delete",staticStyle:{color:"#F56C6C"},on:{click:function(a){t.courseQuestionConfirm(e.QID)}}})]),t._v(" "),a("div",{staticClass:"chat_news_cont"},[a("span",[t._v(t._s(e.QContent))])])])])}),0):a("div",{staticClass:"chat_content",staticStyle:{"text-align":"center","line-height":"50px"}},[t._v("\n              暂无提问\n            ")])]),t._v(" "),e.disabled?t._e():a("div",{staticClass:"chat_put"},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入提问内容",maxlength:"500","show-word-limit":!0},model:{value:t.formQuestion.content,callback:function(e){t.$set(t.formQuestion,"content",e)},expression:"formQuestion.content"}}),t._v(" "),a("el-button",{staticClass:"chat_btn",attrs:{type:"primary",plain:"",size:"small",loading:t.btnLoading},on:{click:t.courseQuestionSave}},[t._v("发送\n            ")])],1)])}),1)],1)],1)])},staticRenderFns:[]};var h=a("VU/8")(u,m,!1,function(t){a("1JVM")},"data-v-e6fc8fb6",null);e.default=h.exports}});
//# sourceMappingURL=41.20231227165236.js.map